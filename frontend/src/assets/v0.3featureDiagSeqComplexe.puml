@startuml
participant "Utilisateur IntÃ©ressÃ© (par l'annonce)" as UI
participant "Frontend (React)" as FE
participant "Backend API" as API
participant "Base de DonnÃ©es" as DB
participant "WebSockets" as WS
participant "Proposeur (de l'annonce)" as P

== ğŸ“© 1. L'utilisateur envoie une demande dâ€™intÃ©rÃªt ==
UI -> FE: Clique sur "Demander"
FE -> API: **POST** /interests (proposition_id, interested_user_id)
API -> DB: ğŸ” VÃ©rifie que la proposition existe
DB --> API: âœ… OK
API -> DB: ğŸ“ Enregistre la demande avec statut **"pending"**
DB --> API: âœ… OK (id_interet)
API -> WS: ğŸ“¡ **Ã‰met une notification au proposeur**
WS --> P: ğŸ”” "Nouvelle demande reÃ§ue"

== ğŸ“¥ 2. Le proposeur consulte ses demandes ==
P -> FE: AccÃ¨de Ã  "Mes IntÃ©rÃªts ReÃ§us"
FE -> API: **GET** /interests/received/:userId
API -> DB: ğŸ” RÃ©cupÃ¨re toutes les demandes associÃ©es Ã  lâ€™utilisateur
DB --> API: ğŸ“‹ Renvoie les demandes (id, titre, utilisateur intÃ©ressÃ©)
API --> FE: ğŸ–¥ï¸ Affiche la liste des demandes

== âœ… 3A. Le proposeur **accepte** la demande ==
P -> FE: Clique sur "**Accepter**"
FE -> API: **PUT** /interests/:id (status: accepted)
API -> DB: âœ… Met Ã  jour le statut en **"accepted"**
DB --> API: âœ… OK

== **Notification & accÃ¨s aux contacts** ==
API -> DB: ğŸ” RÃ©cupÃ¨re le user_id de lâ€™utilisateur intÃ©ressÃ©
DB --> API: âœ… OK (user_id)
API -> DB: ğŸ“ RÃ©cupÃ¨re les coordonnÃ©es du proposeur (email & tÃ©lÃ©phone)
DB --> API: ğŸ“‹ OK
API -> WS: ğŸ“¡ **Ã‰met une notification avec le statut acceptÃ©**
WS --> UI: ğŸ”” "**ğŸ‰ Votre demande a Ã©tÃ© acceptÃ©e ! Voici les contacts ğŸ“§ğŸ“**"
UI -> FE: ğŸ“¥ AccÃ¨de Ã  "Mes Demandes EnvoyÃ©es"
FE -> API: **GET** /interests/sent/:userId
API -> DB: ğŸ” RÃ©cupÃ¨re les demandes mises Ã  jour
DB --> API: ğŸ“‹ Renvoie les demandes avec statut mis Ã  jour
API --> FE: ğŸ–¥ï¸ Affiche la demande comme "AcceptÃ©e" âœ…

== âŒ 3B. Le proposeur **refuse** la demande ==
P -> FE: Clique sur "**Refuser**"
FE -> API: **PUT** /interests/:id (status: rejected)
API -> DB: âŒ Met Ã  jour le statut en **"rejected"**
DB --> API: âœ… OK

==ï¸ **Notification de refus** ==
API -> DB: ğŸ” RÃ©cupÃ¨re le user_id de lâ€™utilisateur intÃ©ressÃ©
DB --> API: âœ… OK (user_id)
API -> WS: ğŸ“¡ **Ã‰met une notification avec le statut refusÃ©**
WS --> UI: ğŸ”” "**âŒ Votre demande a Ã©tÃ© refusÃ©e.**"
UI -> FE: ğŸ“¥ AccÃ¨de Ã  "Mes Demandes EnvoyÃ©es"
FE -> API: **GET** /interests/sent/:userId
API -> DB: ğŸ” RÃ©cupÃ¨re les demandes mises Ã  jour
DB --> API: ğŸ“‹ Renvoie les demandes avec statut mis Ã  jour
API --> FE: ğŸ–¥ï¸ Affiche la demande comme "RefusÃ©e" âŒ

@enduml